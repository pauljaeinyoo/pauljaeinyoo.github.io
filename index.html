<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookFlow - Premium Book Store</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Braze SDK -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js');
        }

        +function(a,p,P,b,y){
            a.braze={};a.brazeQueue=[];
            const s="BrazeSdkMetadata DeviceProperties Card Card.prototype.dismissCard Card.prototype.removeAllSubscriptions Card.prototype.removeSubscription Card.prototype.subscribeToClickedEvent Card.prototype.subscribeToDismissedEvent Card.fromContentCardsJson ImageOnly CaptionedImage ClassicCard ControlCard ContentCards ContentCards.prototype.getUnviewedCardCount Feed Feed.prototype.getUnreadCardCount ControlMessage InAppMessage InAppMessage.SlideFrom InAppMessage.ClickAction InAppMessage.DismissType InAppMessage.OpenTarget InAppMessage.ImageStyle InAppMessage.Orientation InAppMessage.TextAlignment InAppMessage.CropType InAppMessage.prototype.closeMessage InAppMessage.prototype.removeAllSubscriptions InAppMessage.prototype.removeSubscription InAppMessage.prototype.subscribeToClickedEvent InAppMessage.prototype.subscribeToDismissedEvent InAppMessage.fromJson FullScreenMessage ModalMessage HtmlMessage SlideUpMessage User User.Genders User.NotificationSubscriptionTypes User.prototype.addAlias User.prototype.addToCustomAttributeArray User.prototype.addToSubscriptionGroup User.prototype.getUserId User.prototype.incrementCustomUserAttribute User.prototype.removeFromCustomAttributeArray User.prototype.removeFromSubscriptionGroup User.prototype.setCountry User.prototype.setCustomLocationAttribute User.prototype.setCustomUserAttribute User.prototype.setDateOfBirth User.prototype.setEmail User.prototype.setEmailNotificationSubscriptionType User.prototype.setFirstName User.prototype.setGender User.prototype.setHomeCity User.prototype.setLanguage User.prototype.setLastKnownLocation User.prototype.setLastName User.prototype.setPhoneNumber User.prototype.setPushNotificationSubscriptionType InAppMessageButton InAppMessageButton.prototype.removeAllSubscriptions InAppMessageButton.prototype.removeSubscription InAppMessageButton.prototype.subscribeToClickedEvent FeatureFlag FeatureFlag.prototype.getStringProperty FeatureFlag.prototype.getNumberProperty FeatureFlag.prototype.getBooleanProperty automaticallyShowInAppMessages destroyFeed hideContentCards showContentCards showFeed showInAppMessage deferInAppMessage toggleContentCards toggleFeed changeUser destroy getDeviceId initialize isPushBlocked isPushPermissionGranted isPushSupported logCardClick logCardDismissal logCardImpressions logContentCardImpressions logContentCardClick logCustomEvent logFeedDisplayed logInAppMessageButtonClick logInAppMessageClick logInAppMessageHtmlClick logInAppMessageImpression logPurchase openSession requestPushPermission removeAllSubscriptions removeSubscription requestContentCardsRefresh requestFeedRefresh refreshFeatureFlags requestImmediateDataFlush enableSDK isDisabled setLogger setSdkAuthenticationSignature addSdkMetadata disableSDK subscribeToContentCardsUpdates subscribeToFeedUpdates subscribeToInAppMessage subscribeToSdkAuthenticationFailures toggleLogging unregisterPush wipeData handleBrazeAction subscribeToFeatureFlagsUpdates getAllFeatureFlags logFeatureFlagImpression"
            .split(" ");
            for (var i = 0; i < s.length; i++) {
                var m = s[i], k = a.braze, l = m.split(".");
                for (var j = 0; j < l.length - 1; j++) k = k[l[j]];
                k[l[j]] = new Function("return function " + m.replace(/\./g, "_") +
                    "(){window.brazeQueue.push(arguments); return true}")();
            }
            y = p.createElement(P);
            y.type = 'text/javascript';
            y.src = 'https://js.appboycdn.com/web-sdk/5.1/braze.min.js';
            y.async = 1;
            b = p.getElementsByTagName(P)[0];
            b.parentNode.insertBefore(y, b);
        }(window, document, 'script');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #111111;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Navigation */
        .navbar {
            background: #ffffff;
            border-bottom: 1px solid #e5e5e5;
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 0;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            height: 80px;
        }

        .nav-left .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 800;
            color: #111111;
        }

        .nav-left .logo i {
            color: #ff6b35;
        }

        .nav-center {
            display: flex;
            gap: 40px;
        }

        .nav-link {
            text-decoration: none;
            color: #111111;
            font-weight: 500;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: color 0.3s ease;
            position: relative;
        }

        .nav-link:hover,
        .nav-link.active {
            color: #ff6b35;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -30px;
            left: 0;
            width: 100%;
            height: 3px;
            background: #ff6b35;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: #f5f5f5;
            border-radius: 25px;
            padding: 10px 20px;
            gap: 10px;
        }

        .search-bar input {
            border: none;
            background: none;
            outline: none;
            font-size: 0.9rem;
            width: 200px;
        }

        .search-bar i {
            color: #666;
        }

        .nav-actions {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #111111;
            cursor: pointer;
            position: relative;
            padding: 10px;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .nav-btn:hover {
            background: #f5f5f5;
        }

        .cart-count {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff6b35;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 100px 0;
            display: flex;
            align-items: center;
            min-height: 600px;
        }

        .hero-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
        }

        .hero-content h1 {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.1;
        }

        .hero-content p {
            font-size: 1.3rem;
            margin-bottom: 40px;
            opacity: 0.9;
            line-height: 1.6;
        }

        .cta-btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cta-btn:hover {
            background: #e55a2b;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.3);
        }

        .hero-image {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .book-stack {
            position: relative;
            width: 300px;
            height: 400px;
        }

        .book {
            position: absolute;
            width: 200px;
            height: 280px;
            border-radius: 5px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .book-1 {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            transform: rotate(-15deg) translateY(20px);
        }

        .book-2 {
            background: linear-gradient(45deg, #667eea, #764ba2);
            transform: rotate(-5deg) translateY(10px);
        }

        .book-3 {
            background: linear-gradient(45deg, #28a745, #20c997);
            transform: rotate(5deg) translateY(0);
        }

        /* Categories Section */
        .categories {
            padding: 100px 0;
            background: #f8f9fa;
        }

        .categories h2 {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 60px;
            color: #111111;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .category-card {
            background: white;
            padding: 40px 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .category-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .category-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            color: white;
        }

        .category-card h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #111111;
        }

        .category-card p {
            color: #666;
            font-size: 1rem;
        }

        /* Featured Books */
        .featured {
            padding: 100px 0;
        }

        .featured h2 {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 60px;
            color: #111111;
        }

        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 40px;
        }

        .book-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .book-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .book-image {
            height: 350px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            position: relative;
        }

        .book-image::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 5px;
        }

        .book-info {
            padding: 25px;
        }

        .book-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #111111;
        }

        .book-author {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .book-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ff6b35;
            margin-bottom: 20px;
        }

        .add-to-cart-btn {
            background: #111111;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .add-to-cart-btn:hover {
            background: #ff6b35;
        }

        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 20px rgba(0,0,0,0.1);
            z-index: 1001;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.open {
            right: 0;
        }

        .cart-header {
            padding: 30px;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111111;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .cart-items {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .cart-item {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .cart-item-image {
            width: 60px;
            height: 80px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 5px;
            flex-shrink: 0;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #111111;
        }

        .cart-item-price {
            color: #ff6b35;
            font-weight: 600;
        }

        .cart-footer {
            padding: 30px;
            border-top: 1px solid #e5e5e5;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #111111;
        }

        .checkout-btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s ease;
        }

        .checkout-btn:hover {
            background: #e55a2b;
        }

        /* Braze Section */
        .braze-section {
            background: #f8f9fa;
            padding: 80px 0;
        }

        .braze-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .braze-header h2 {
            font-size: 2rem;
            font-weight: 600;
            color: #111111;
        }

        .braze-controls {
            display: flex;
            gap: 10px;
        }

        .braze-btn {
            background: #111111;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .braze-btn:hover {
            background: #ff6b35;
        }

        .braze-feed {
            min-height: 200px;
        }

        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .loading-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-container {
                padding: 0 15px;
                height: 60px;
            }

            .nav-center {
                display: none;
            }

            .search-bar input {
                width: 150px;
            }

            .hero-content {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 40px;
            }

            .hero-content h1 {
                font-size: 2.5rem;
            }

            .book-stack {
                width: 200px;
                height: 300px;
            }

            .book {
                width: 150px;
                height: 200px;
            }

            .category-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
            }

            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
            }

            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <div class="logo">
                    <i class="fas fa-book-open"></i>
                    <span>BookFlow</span>
                </div>
            </div>
            <div class="nav-center">
                <a href="index.html" class="nav-link active">New & Featured</a>
                <a href="fiction.html" class="nav-link">Fiction</a>
                <a href="non-fiction.html" class="nav-link">Non-Fiction</a>
                <a href="sci-fi.html" class="nav-link">Science Fiction</a>
                <a href="biography.html" class="nav-link">Biography</a>
                <a href="self-help.html" class="nav-link">Self-Help</a>
            </div>
            <div class="nav-right">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search for books...">
                </div>
                <div class="nav-actions">
                    <button class="nav-btn" onclick="showCart()">
                        <i class="fas fa-shopping-bag"></i>
                        <span class="cart-count" id="cart-count">0</span>
                    </button>
                    <button class="nav-btn" onclick="showUserMenu()">
                        <i class="fas fa-user"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <div>
                <h1>DISCOVER YOUR NEXT GREAT READ</h1>
                <p>Explore thousands of books across all genres. Find your perfect story.</p>
                <button class="cta-btn" onclick="scrollToFeatured()">
                    SHOP NOW
                </button>
            </div>
            <div class="hero-image">
                <div class="book-stack">
                    <div class="book book-1"></div>
                    <div class="book book-2"></div>
                    <div class="book book-3"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Categories -->
    <section class="categories">
        <div class="container">
            <h2>Shop by Category</h2>
            <div class="category-grid">
                <div class="category-card" onclick="window.location.href='fiction.html'">
                    <div class="category-icon">
                        <i class="fas fa-magic"></i>
                    </div>
                    <h3>Fiction</h3>
                    <p>Imaginative stories</p>
                </div>
                <div class="category-card" onclick="window.location.href='non-fiction.html'">
                    <div class="category-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h3>Non-Fiction</h3>
                    <p>Real-world knowledge</p>
                </div>
                <div class="category-card" onclick="window.location.href='sci-fi.html'">
                    <div class="category-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <h3>Science Fiction</h3>
                    <p>Future possibilities</p>
                </div>
                <div class="category-card" onclick="window.location.href='biography.html'">
                    <div class="category-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h3>Biography</h3>
                    <p>Life stories</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Books -->
    <section class="featured" id="featured">
        <div class="container">
            <h2>Featured Books</h2>
            <div class="books-grid" id="books-grid">
                <!-- Books will be populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Shopping Cart Sidebar -->
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h3>Shopping Cart</h3>
            <button class="close-btn" onclick="hideCart()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-items" id="cart-items">
            <!-- Cart items will be populated by JavaScript -->
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cart-total">$0.00</span>
            </div>
            <button class="checkout-btn" onclick="checkout()">
                CHECKOUT
            </button>
        </div>
    </div>

    <!-- Braze Content Cards Section -->
    <section class="braze-section">
        <div class="container">
            <div class="braze-header">
                <h2><i class="fas fa-bell"></i> Personalized Recommendations</h2>
                <div class="braze-controls">
                    <button class="braze-btn" onclick="toggleBrazeCards()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="braze-btn" onclick="hideBrazeCards()">
                        <i class="fas fa-eye-slash"></i> Hide
                    </button>
                    <button class="braze-btn" onclick="showBrazeCards()">
                        <i class="fas fa-eye"></i> Show
                    </button>
                </div>
            </div>
            <div id="braze-feed" class="braze-feed">
                <div class="loading-state">
                    <i class="fas fa-satellite-dish"></i>
                    <h3>Loading recommendations...</h3>
                    <p>Finding books just for you</p>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Application State
        let cart = [];
        let books = [];
        let currentCategory = 'all';

        // Sample book data
        const sampleBooks = [
            {
                id: 1,
                title: "The Great Gatsby",
                author: "F. Scott Fitzgerald",
                price: 12.99,
                category: "fiction",
                image: "📚"
            },
            {
                id: 2,
                title: "To Kill a Mockingbird",
                author: "Harper Lee",
                price: 14.99,
                category: "fiction",
                image: "📖"
            },
            {
                id: 3,
                title: "1984",
                author: "George Orwell",
                price: 11.99,
                category: "sci-fi",
                image: "🔮"
            },
            {
                id: 4,
                title: "Steve Jobs",
                author: "Walter Isaacson",
                price: 16.99,
                category: "biography",
                image: "👨‍💼"
            },
            {
                id: 5,
                title: "The Art of War",
                author: "Sun Tzu",
                price: 9.99,
                category: "non-fiction",
                image: "⚔️"
            },
            {
                id: 6,
                title: "Dune",
                author: "Frank Herbert",
                price: 15.99,
                category: "sci-fi",
                image: "🏜️"
            }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            books = sampleBooks;
            loadBooks();
            initializeBraze();
        });

        function initializeBraze() {
            // Initialize Braze once the SDK is ready
            braze.initialize('7ad461d4-5c54-45a1-a0f2-c018596c87ca', {
                baseUrl: "sondheim.braze.com",
                enableLogging: true,
                allowUserSuppliedJavascript: true
            });

            braze.toggleLogging();
            braze.changeUser('pjy');
            
            braze.openSession(() => {
                braze.requestContentCardsRefresh();
                braze.showContentCards(document.getElementById("braze-feed"));
            });

            // Set user attributes
            const user = braze.getUser();
            user.setCustomUserAttribute('app_name', 'BookFlow');
            user.setCustomUserAttribute('total_books', books.length);
        }

        function loadBooks() {
            const booksGrid = document.getElementById('books-grid');
            booksGrid.innerHTML = books.map(book => `
                <div class="book-card" onclick="addToCart(${book.id})">
                    <div class="book-image">
                        <span>${book.image}</span>
                    </div>
                    <div class="book-info">
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">by ${book.author}</div>
                        <div class="book-price">$${book.price}</div>
                        <button class="add-to-cart-btn" onclick="event.stopPropagation(); addToCart(${book.id})">
                            ADD TO CART
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterByCategory(category) {
            currentCategory = category;
            
            // Track with Braze
            braze.logCustomEvent('Category Filtered', {
                'category': category
            });
            
            if (category === 'all') {
                loadBooks();
            } else {
                const filteredBooks = books.filter(book => book.category === category);
                const booksGrid = document.getElementById('books-grid');
                booksGrid.innerHTML = filteredBooks.map(book => `
                    <div class="book-card" onclick="addToCart(${book.id})">
                        <div class="book-image">
                            <span>${book.image}</span>
                        </div>
                        <div class="book-info">
                            <div class="book-title">${book.title}</div>
                            <div class="book-author">by ${book.author}</div>
                            <div class="book-price">$${book.price}</div>
                            <button class="add-to-cart-btn" onclick="event.stopPropagation(); addToCart(${book.id})">
                                ADD TO CART
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function addToCart(bookId) {
            const book = books.find(b => b.id === bookId);
            if (book) {
                const existingItem = cart.find(item => item.id === bookId);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    cart.push({ ...book, quantity: 1 });
                }
                updateCart();
                
                // Track with Braze
                braze.logCustomEvent('Book Added to Cart', {
                    'book_title': book.title,
                    'book_author': book.author,
                    'book_price': book.price,
                    'book_category': book.category,
                    'cart_total': cart.length
                });
            }
        }

        function updateCart() {
            const cartCount = document.getElementById('cart-count');
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            cartCount.textContent = totalItems;
            cartTotal.textContent = `$${totalPrice.toFixed(2)}`;
            
            cartItems.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <div class="cart-item-image"></div>
                    <div class="cart-item-info">
                        <div class="cart-item-title">${item.title}</div>
                        <div class="cart-item-price">$${item.price} x ${item.quantity}</div>
                    </div>
                </div>
            `).join('');
        }

        function showCart() {
            document.getElementById('cart-sidebar').classList.add('open');
            
            // Track with Braze
            braze.logCustomEvent('Cart Opened', {
                'cart_items': cart.length,
                'cart_total': cart.reduce((sum, item) => sum + (item.price * item.quantity), 0)
            });
        }

        function hideCart() {
            document.getElementById('cart-sidebar').classList.remove('open');
        }

        function checkout() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            // Track with Braze
            braze.logPurchase('checkout', 'USD', cart.reduce((sum, item) => sum + (item.price * item.quantity), 0));
            
            alert('Thank you for your purchase!');
            cart = [];
            updateCart();
            hideCart();
        }

        function scrollToFeatured() {
            document.getElementById('featured').scrollIntoView({ behavior: 'smooth' });
        }

        function showUserMenu() {
            // Track with Braze
            braze.logCustomEvent('User Menu Opened');
            alert('User menu functionality coming soon!');
        }

        // Braze helper functions
        function toggleBrazeCards() {
            braze.toggleContentCards(document.getElementById("braze-feed"));
            braze.logCustomEvent('Content Cards Toggled', { 
                'current_category': currentCategory,
                'total_books': books.length
            });
        }

        function hideBrazeCards() {
            braze.hideContentCards();
            braze.logCustomEvent('Content Cards Hidden', { 
                'current_category': currentCategory,
                'total_books': books.length
            });
        }

        function showBrazeCards() {
            braze.showContentCards(document.getElementById("braze-feed"));
            braze.logCustomEvent('Content Cards Shown', { 
                'current_category': currentCategory,
                'total_books': books.length
            });
        }
    </script>
</body>
</html>
